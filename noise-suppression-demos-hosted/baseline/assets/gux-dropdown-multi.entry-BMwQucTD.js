import{r as h,c as a,f as p,h as i,g as x}from"./index-d9wy7qxQ.js";import{O as m}from"./on-click-outside-21dd269e-C4O7qXsf.js";import{b}from"./index-3f1e5ba8-CvJZzdvG.js";import{s as c}from"./simulate-native-event-e0631897-BcLDngo1.js";import{b as v}from"./after-next-render-07a41f53-C_KTwidI.js";import{o as C}from"./on-input-disabled-state-change-27395154-_B452ZSd.js";import{t as E}from"./usage-6129fffe-6kP8_2TX.js";import{s as g,g as w}from"./gux-listbox.service-28ef1770-C3DRrCFi.js";import{O as y}from"./on-mutation-1355c534-BWobL9kd.js";import"vite-plugin-node-polyfills/shims/process";import"vite-plugin-node-polyfills/shims/buffer";import"./get-closest-element-728b9f18-C_5KDHD-.js";const I="Type to filter dropdown results",T="Select...",F="Dropdown",R="{numberSelected} selected",O="Press Enter to create new option, {textInputValue}",S={textInputResults:I,noSelection:T,dropdown:F,numberSelected:R,pressEnterToCreate:O},L=":host{box-sizing:border-box;color:var(--gse-ui-formControl-input-populatedColor)}.gux-dropdown-container{position:relative}.gux-error.gux-target-container-collapsed .gux-field-button,.gux-error.gux-target-container-expanded{border:var(--gse-ui-formControl-input-error-border-width) var(--gse-ui-formControl-input-error-border-style) var(--gse-ui-formControl-input-error-border-color)}.gux-disabled.gux-target-container-collapsed .gux-field-button,.gux-disabled.gux-target-container-expanded{border:var(--gse-ui-formControl-input-disabled-border-width) var(--gse-ui-formControl-input-disabled-border-style) var(--gse-ui-formControl-input-disabled-border-color)}.gux-field,.gux-target-container-expanded{all:unset;box-sizing:border-box;display:flex;flex-direction:row;flex-wrap:nowrap;place-content:stretch center;align-items:center;width:100%;height:var(--gse-ui-formControl-input-textfield-height);font-family:var(--gse-ui-formControl-input-contentText-fontFamily);font-size:var(--gse-ui-formControl-input-contentText-fontSize);font-weight:var(--gse-ui-formControl-input-contentText-fontWeight);line-height:var(--gse-ui-formControl-input-contentText-lineHeight);cursor:pointer;background-color:var(--gse-ui-formControl-input-backgroundColor)}.gux-target-container-expanded,.gux-target-container-collapsed .gux-field{padding:var(--gse-ui-formControl-input-padding)}.gux-target-container-collapsed .gux-field-button:hover,.gux-target-container-expanded:hover{border:var(--gse-ui-formControl-input-hover-border-width) var(--gse-ui-formControl-input-hover-border-style) var(--gse-ui-formControl-input-hover-border-color)}.gux-field.gux-input-field{height:var(--gse-ui-formControl-input-contentText-lineHeight)}.gux-field .gux-field-content{position:relative;display:flex;flex:1 1 0;flex-direction:row;flex-wrap:nowrap;place-content:stretch flex-start;align-items:flex-start;min-width:0;height:var(--gse-ui-formControl-input-contentText-lineHeight)}.gux-field .gux-field-content .gux-filter,.gux-field .gux-field-content .gux-selected-option,.gux-field .gux-field-content .gux-placeholder{flex:1 1 auto;align-self:auto;order:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.gux-field .gux-field-content .gux-filter .gux-sr-only:not(:focus):not(:active),.gux-field .gux-field-content .gux-selected-option .gux-sr-only:not(:focus):not(:active),.gux-field .gux-field-content .gux-placeholder .gux-sr-only:not(:focus):not(:active){position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0 0 0 0);clip-path:inset(50%);white-space:nowrap}.gux-field .gux-field-content .gux-filter{position:relative;height:100%;padding-left:0}.gux-field .gux-field-content .gux-filter .gux-filter-input{all:unset;width:100%;color:transparent;caret-color:var(--gse-ui-formControl-input-populatedColor)}.gux-field .gux-field-content .gux-filter .gux-filter-display{white-space:pre}.gux-field .gux-field-content .gux-filter .gux-filter-display .gux-filter-text{color:var(--gse-ui-formControl-input-populatedColor)}.gux-field .gux-field-content .gux-filter .gux-filter-display .gux-filter-suggestion{color:var(--gse-ui-formControl-input-suggestionColor)}.gux-field .gux-field-content .gux-filter .gux-filter-input,.gux-field .gux-field-content .gux-filter .gux-filter-display{position:absolute}.gux-field .gux-field-content .gux-placeholder{color:var(--gse-ui-formControl-input-placeholderColor)}.gux-field .gux-expand-icon{flex:0 0 auto;align-self:auto;order:0;width:var(--gse-ui-formControl-input-inputIcon-size);height:var(--gse-ui-formControl-input-inputIcon-size);padding-left:var(--gse-ui-dropdown-gap);color:var(--gse-ui-formControl-input-inputIcon-iconEndColor)}.gux-target-container-expanded{border:var(--gse-ui-formControl-input-active-border-width) var(--gse-ui-formControl-input-active-border-style) var(--gse-ui-formControl-input-active-border-color);border-radius:var(--gse-ui-formControl-input-borderRadius)}.gux-target-container-expanded:focus-visible{outline:var(--gse-semantic-focusRing-default-border-color) var(--gse-semantic-focusRing-default-border-style) var(--gse-semantic-focusRing-default-border-width);outline-offset:var(--gse-semantic-focusRing-offset)}.gux-target-container-expanded:focus-within:has(:focus-visible){outline:var(--gse-semantic-focusRing-default-border-color) var(--gse-semantic-focusRing-default-border-style) var(--gse-semantic-focusRing-default-border-width);outline-offset:var(--gse-semantic-focusRing-offset)}.gux-target-container-expanded .gux-filter-input{background-color:inherit;border:none}.gux-target-container-expanded .gux-filter-input:focus{border:none;outline:none}.gux-target-container-expanded .gux-field-button{width:auto;height:var(--gse-ui-formControl-input-contentText-lineHeight);margin:0;background:inherit;border:none;outline:none;box-shadow:none}.gux-target-container-expanded .gux-field-button:focus{outline:none}.gux-target-container-collapsed .gux-field-button{border:var(--gse-ui-formControl-input-default-border-width) var(--gse-ui-formControl-input-default-border-style) var(--gse-ui-formControl-input-default-border-color);border-radius:var(--gse-ui-formControl-input-borderRadius)}.gux-target-container-collapsed .gux-field-button:focus-visible{outline:var(--gse-semantic-focusRing-default-border-color) var(--gse-semantic-focusRing-default-border-style) var(--gse-semantic-focusRing-default-border-width);outline-offset:var(--gse-semantic-focusRing-offset)}.gux-target-container-collapsed .gux-field-button:focus-within:has(:focus-visible){outline:var(--gse-semantic-focusRing-default-border-color) var(--gse-semantic-focusRing-default-border-style) var(--gse-semantic-focusRing-default-border-width);outline-offset:var(--gse-semantic-focusRing-offset)}.gux-listbox-container{box-sizing:border-box;margin:0}",P=L;var f=function(t,e,o,n){var r=arguments.length,s=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,o):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,o,n);else for(var u=t.length-1;u>=0;u--)(l=t[u])&&(s=(r<3?l(s):r>3?l(e,o,s):l(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};const d=class{constructor(t){h(this,t),this.guxcreateoption=a(this,"guxcreateoption",7),this.guxexpanded=a(this,"guxexpanded",7),this.guxcollapsed=a(this,"guxcollapsed",7),this.guxfilter=a(this,"guxfilter",7),this.value=void 0,this.disabled=!1,this.required=!1,this.loading=!1,this.placeholder=void 0,this.filterType="none",this.hasError=!1,this.hasCreate=!1,this.expanded=!1,this.textInput=""}onMutation(){var t;this.listboxElement||(this.listboxElement=(t=this.root)===null||t===void 0?void 0:t.querySelector("gux-listbox-multi"),this.applyListboxEventListeners())}onInternalExpanded(t){t.stopPropagation(),this.guxexpanded.emit()}onInternalCollapsed(t){t.stopPropagation(),this.guxcollapsed.emit()}focusSelectedItemAfterRender(t){t&&this.listboxElement&&v(()=>{this.hasTextInput()?this.textInputElement.focus():this.listboxElement.focus()}),t||(this.textInput="")}watchValue(t){this.validateValue(t,this.listboxElement)}handleFilter(t){this.guxfilter.emit(t)}getSelectedValues(){var t;return Promise.resolve(((t=this.value)===null||t===void 0?void 0:t.split(","))||[])}onKeydown(t){switch(t.key){case"Escape":if(this.hasTextInput()&&document.activeElement===this.listboxElement)return this.textInputElement.focus();this.collapseListbox("focusFieldButton");return;case"Tab":if(this.shiftTabFromFilterListbox(t))return t.preventDefault(),this.textInputElement.focus();if(this.shiftTabFromExpandedFilterInput(t))return t.preventDefault(),this.collapseListbox("focusFieldButton");this.collapseListbox("noFocusChange");return;case"ArrowDown":this.activeElementNotListbox()&&(t.preventDefault(),this.expanded=!0,g(this.listboxElement));return;case"Enter":this.canCreateNewOption()&&this.isActiveElement()&&this.emitCreateOption()}}onInternallistboxoptionsupdated(t){t.stopPropagation(),p(this.root)}onClearselected(t){t.stopPropagation(),this.updateValue(""),this.listboxElement&&(this.listboxElement.value=void 0),this.validateValue(this.value,this.listboxElement),this.fieldButtonElement.focus()}onCreatenewoption(t){t.stopPropagation(),this.emitCreateOption()}onBlur(t){this.stopPropagationOfInternalFocusEvents(t)}onFocus(t){this.stopPropagationOfInternalFocusEvents(t)}onFocusout(t){this.stopPropagationOfInternalFocusEvents(t)}onFocusin(t){this.stopPropagationOfInternalFocusEvents(t)}onClickOutside(){this.collapseListbox("noFocusChange")}connectedCallback(){var t;this.listboxElement=(t=this.root)===null||t===void 0?void 0:t.querySelector("gux-listbox-multi"),this.listboxElement&&(this.validateValue(this.value,this.listboxElement),this.hasCreate=!!this.root.querySelector("gux-create-option"))}async componentWillLoad(){E(this.root),this.i18n=await b(this.root,S),C(this.root,()=>{p(this.root)})}componentDidLoad(){this.applyListboxEventListeners()}componentWillRender(){this.listboxElement&&(this.validateValue(this.value,this.listboxElement),this.listboxElement.loading=this.loading,this.listboxElement.filterType=this.filterType,this.listboxElement.textInput=this.textInput)}validateValue(t,e){if(t===void 0){e&&(e.value=t);return}if(this.getOptionElementByValue(t)){e.value=t;return}this.value=void 0}hasTextInput(){return this.isFilterable()||this.hasCreate}applyListboxEventListeners(){var t,e;(t=this.listboxElement)===null||t===void 0||t.addEventListener("input",o=>{o.stopPropagation(),this.updateValue(o.target.value)}),(e=this.listboxElement)===null||e===void 0||e.addEventListener("change",o=>{o.stopPropagation()})}isFilterable(){return this.filterType==="custom"||this.filterType==="starts-with"}stopPropagationOfInternalFocusEvents(t){if(this.root.contains(t.relatedTarget))return t.stopImmediatePropagation()}getOptionElementByValue(t){const e=Array.from(this.root.querySelectorAll("gux-option-multi")),o=t?t.split(","):void 0;if(o)return e.filter(n=>o.includes(n.value))}fieldButtonClick(){this.expanded=!this.expanded}fieldButtonInputClick(){this.expanded||(this.expanded=!this.expanded)}filterInput(t){t.stopPropagation(),this.textInput=this.textInputElement.value}shiftTabFromExpandedFilterInput(t){return t.shiftKey&&this.hasTextInput()&&this.expanded&&document.activeElement!==this.listboxElement}shiftTabFromFilterListbox(t){return t.shiftKey&&this.hasTextInput()&&document.activeElement===this.listboxElement}emitCreateOption(){this.guxcreateoption.emit(this.textInput),this.textInput="",this.textInputElement.value=""}canCreateNewOption(){return this.hasCreate&&this.textInput&&!this.listboxElement.hasExactMatch}isActiveElement(){return document.activeElement===this.root}activeElementNotListbox(){return document.activeElement!==this.listboxElement}filterKeydown(t){switch(t.key){case"ArrowDown":t.stopImmediatePropagation(),t.preventDefault(),this.listboxElement.focus(),g(this.listboxElement);return}}filterKeyup(t){switch(t.key){case" ":t.preventDefault();return}}collapseListbox(t){this.expanded&&(this.expanded=!1),t==="focusFieldButton"&&this.fieldButtonElement.focus()}updateValue(t){this.value!==t&&(this.value=t,c(this.root,"input"),c(this.root,"change"))}getTypeaheadText(t){var e;const o=t.length;if(o>0&&!this.loading){const n=w(this.listboxElement,t);if(n&&this.filterType!=="custom"){const r=(e=n.querySelector("[gux-slot-container]"))===null||e===void 0?void 0:e.textContent;return r==null?void 0:r.substring(o)}return""}}renderTargetDisplay(){return i("div",{class:"gux-placeholder"},this.placeholder||this.i18n("noSelection"),this.getSrSelectedText())}getSrSelectedText(){const t=this.getOptionElementByValue(this.value);if(t!=null&&t.length)return i("span",{class:"gux-sr-only"},this.i18n("numberSelected",{numberSelected:t.length.toString()}))}getInputAriaLabel(){return this.canCreateNewOption()&&this.isActiveElement()?this.i18n("pressEnterToCreate",{textInputValue:this.textInput}):this.i18n("textInputResults")}renderTag(){var t;const e=((t=this.value)===null||t===void 0?void 0:t.split(","))||[];if(e.length)return i("gux-dropdown-multi-tag",{disabled:this.disabled,"number-selected":e.length})}renderFilterInputField(){if(this.expanded&&this.hasTextInput())return i("div",{class:"gux-field gux-input-field"},i("div",{class:"gux-field-content"},i("div",{class:"gux-filter"},i("div",{class:"gux-filter-display"},i("span",{class:"gux-filter-text"},this.textInput),i("span",{class:"gux-filter-suggestion"},this.getTypeaheadText(this.textInput))),i("div",{class:"input-and-dropdown-button"},i("input",{onClick:this.fieldButtonInputClick.bind(this),placeholder:this.placeholder||this.i18n("noSelection"),class:"gux-filter-input",type:"text","aria-label":this.getInputAriaLabel(),ref:t=>this.textInputElement=t,onInput:this.filterInput.bind(this),onKeyDown:this.filterKeydown.bind(this),onKeyUp:this.filterKeyup.bind(this)})))))}renderPopup(){return i("div",{slot:"popup",class:"gux-listbox-container"},i("slot",null))}renderTarget(){return i("div",{class:{"gux-target-container":!0,"gux-target-container-expanded":this.expanded&&this.hasTextInput(),"gux-target-container-collapsed":!(this.expanded&&this.hasTextInput()),"gux-error":this.hasError,"gux-disabled":this.disabled},slot:"target"},this.renderFilterInputField(),i("button",{type:"button",class:"gux-field gux-field-button",disabled:this.disabled,onClick:this.fieldButtonClick.bind(this),ref:t=>this.fieldButtonElement=t,"aria-haspopup":"listbox","aria-expanded":this.expanded.toString()},this.renderTargetContent(),this.renderTag(),this.renderRadialLoading(),i("gux-icon",{class:{"gux-expand-icon":!0},"screenreader-text":this.i18n("dropdown"),iconName:"custom/chevron-down-small-regular"})))}renderTargetContent(){if(!(this.expanded&&this.hasTextInput()))return i("div",{class:"gux-field-content"},this.renderTargetDisplay())}renderRadialLoading(){if(this.loading&&!this.expanded)return i("gux-radial-loading",{context:"input"})}render(){return[i("div",{key:"475be896246091f798a81ff2bfc027b41a31c4df",class:"gux-dropdown-container"},i("gux-popup",{key:"02da36e1506eecd9343291e1e45fa7eebef11b2c",expanded:this.expanded&&(!this.loading||this.isFilterable()),disabled:this.disabled},this.renderTarget(),this.renderPopup()))]}static get delegatesFocus(){return!0}get root(){return x(this)}static get watchers(){return{expanded:["focusSelectedItemAfterRender"],value:["watchValue"],textInput:["handleFilter"]}}};f([y({childList:!0,subtree:!0})],d.prototype,"onMutation",null);f([m({triggerEvents:"mousedown"})],d.prototype,"onClickOutside",null);d.style=P;export{d as gux_dropdown_multi};
