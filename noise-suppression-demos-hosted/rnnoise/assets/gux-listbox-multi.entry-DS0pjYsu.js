import{r as v,c as b,h as a,H as O,g as S}from"./index-RhTaIPoL.js";import{d as p,h as E,s as h,e as m,f as g,i as C,j as A,k as y,l as w,m as c,n as L,c as M,a as I,o as V}from"./gux-listbox.service-C9MGEoP7-DMtsKwE7.js";import{b as k}from"./index-Bbwiw1Rf-CzeU2kBB.js";import{w as f}from"./when-event-is-from-kLXvN2m9-B4cyA2sH.js";import{s as r}from"./simulate-native-event-BMRf5pjV-BcLDngo1.js";import{t as D}from"./usage-BYFiy2rf-lhiVWKSr.js";import{b as d}from"./after-next-render-Bg4q97BS-C_KTwidI.js";import{O as H}from"./on-mutation-D5H4nH4U-CeToMEmQ.js";import"vite-plugin-node-polyfills/shims/process";import"vite-plugin-node-polyfills/shims/buffer";import"./get-text-content-from-nodes-DjLdmWVU-BQ4yQ5rq.js";import"./get-closest-element-Cd4R0amv-C_5KDHD-.js";const N="Add {name}",_="No matches",F="Loading...";var T={add:N,noMatches:_,loading:F};const j=":host{scrollbar-color:var(--gse-ui-menu-border-color) transparent;scrollbar-width:thin;box-sizing:border-box;display:block;max-block-size:var(--gse-ui-menu-maxHeight);padding:var(--gse-ui-menu-padding);overflow:hidden auto;outline:none;background:var(--gse-ui-menu-backgroundColor);border:var(--gse-ui-menu-border-width) var(--gse-ui-menu-border-style) var(--gse-ui-menu-border-color);border-radius:var(--gse-ui-menu-borderRadius);box-shadow:var(--gse-ui-menu-boxShadow)}:host ::slotted(gux-select-all){position:sticky;inset-block-start:0}:host(.has-select-all){padding:0}.gux-message-container{display:flex;flex-direction:column;flex-wrap:nowrap;place-content:stretch center;align-items:center}.gux-message-container .gux-no-matches{box-sizing:border-box;block-size:var(--gse-ui-menu-option-height);padding-block:var(--gse-ui-dropdown-gap);font-family:var(--gse-ui-menu-option-label-active-text-fontFamily);font-size:var(--gse-ui-menu-option-label-active-text-fontSize);font-weight:var(--gse-ui-menu-option-label-active-text-fontWeight);line-height:var(--gse-ui-menu-option-label-active-text-lineHeight);color:var(--gse-ui-menu-option-label-foregroundColor)}";var P=function(t,e,i,o){var l=arguments.length,n=l<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,i):o,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,i,o);else for(var u=t.length-1;u>=0;u--)(s=t[u])&&(n=(l<3?s(n):l>3?s(e,i,n):s(e,i))||n);return l>3&&n&&Object.defineProperty(e,i,n),n};const x=class{constructor(t){v(this,t),this.internallistboxoptionsupdated=b(this,"internallistboxoptionsupdated",7),this.loading=!1,this.filter="",this.textInput="",this.filterType="none",this.disabled=!1,this.listboxOptions=[],this.hasExactMatch=!1}onMutation(){d(()=>{this.updateOnSlotChange()})}onBlur(){p(this.root)}selectNewCustomOption(t){this.updateValue(t.detail)}onKeydown(t){var e,i;if(!E(this.root)){t.preventDefault(),h(this.root);return}switch(t.key){case"Enter":t.preventDefault(),!((e=this.optionCreateElement)===null||e===void 0)&&e.active?(this.optionCreateElement.guxEmitInternalCreateNewOption(),d(()=>{h(this.root)})):!((i=this.selectAllElement)===null||i===void 0)&&i.active?this.updateSelectAllState(!0):c(this.root,o=>this.updateValue(o));return;case"ArrowDown":t.preventDefault(),y(this.root)?(t.stopPropagation(),w(this.root)):g(this.root);return;case"ArrowUp":{t.preventDefault(),C(this.root)?(t.stopPropagation(),A(this.root)):m(this.root);return}case"Home":{t.preventDefault(),g(this.root);return}case"End":{t.preventDefault(),m(this.root);return}case" ":{t.preventDefault();return}}if(t.key.length===1){L(this.root,t.key);return}}onKeyup(t){var e,i;switch(t.key){case" ":!((e=this.optionCreateElement)===null||e===void 0)&&e.active?(this.optionCreateElement.guxEmitInternalCreateNewOption(),d(()=>{h(this.root)})):!((i=this.selectAllElement)===null||i===void 0)&&i.active?this.updateSelectAllState(!0):c(this.root,o=>this.updateValue(o));return}}onMousemove(){p(this.root)}onClick(t){f("gux-option-multi",t,e=>{V(e,i=>this.updateValue(i))}),f("gux-select-all",t,()=>{this.updateSelectAllState(!0)})}async guxSelectActive(){c(this.root,t=>this.updateValue(t))}getHasExactMatch(){let t=!1;return this.hasExactMatch=!1,this.listboxOptions.forEach(e=>{var i,o;((o=(i=e.textContent)===null||i===void 0?void 0:i.toLowerCase())===null||o===void 0?void 0:o.trim())==this.textInput.toLowerCase().trim()&&(t=!0,this.hasExactMatch=!0)}),t}updateOptionMultiCreateValue(){this.optionCreateElement&&(this.optionCreateElement.value=this.textInput,this.optionCreateElement.filtered=!this.textInput||this.getHasExactMatch())}getSelectedValues(){return M(this.value)}updateOnSlotChange(){this.setListboxOptions(),this.updateListboxOptions()}getOptionCreateElement(){this.optionCreateElement=this.root.querySelector("gux-create-option")}getSelectAllElement(){this.selectAllElement=this.root.querySelector("gux-select-all")}setListboxOptions(){this.listboxOptions=Array.from(this.root.children).filter(t=>t.tagName==="GUX-OPTION-MULTI"),this.internallistboxoptionsupdated.emit()}updateListboxOptions(){this.listboxOptions.forEach(t=>{t.selected=this.getSelectedValues().includes(t.value),this.filterType!=="custom"&&this.filterType!=="none"&&(t.filtered=!I(t).toLowerCase().startsWith(this.textInput.toLowerCase()))})}updateSelectAllState(t=!1){const e=this.root.querySelector("gux-select-all");if(!e)return;const i=this.listboxOptions.filter(s=>!s.filtered).map(s=>s.value);this.optionCreateElement&&!this.optionCreateElement.filtered&&i.push(this.optionCreateElement.value),t&&(this.value=e.selected?void 0:i.join(","),r(this.root,"input"),r(this.root,"change"));const o=this.getSelectedValues(),l=i.length>0&&i.every(s=>o.includes(s)),n=i.some(s=>o.includes(s));e.selected=l,e.indeterminate=!l&&n}updateValue(t){if(this.getSelectedValues().includes(t)){const e=this.getSelectedValues().filter(i=>i!==t);this.value=e.length?e.join(","):void 0}else{const e=[...this.getSelectedValues(),t];this.value=e.join(",")}r(this.root,"input"),r(this.root,"change"),this.updateSelectAllState()}async componentWillLoad(){D(this.root),this.i18n=await k(this.root,T),this.setListboxOptions(),this.getOptionCreateElement(),this.getSelectAllElement()}componentWillRender(){this.setListboxOptions(),this.updateListboxOptions(),this.allListboxOptionsFiltered=this.listboxOptions.filter(t=>!t.filtered).length===0,this.updateSelectAllState()}renderHiddenSlot(){return a("div",{hidden:!0},a("slot",{onSlotchange:()=>this.setListboxOptions()}))}renderLoading(){return[a("div",{class:"gux-message-container"},a("gux-radial-loading",{context:"modal"}),a("span",null,this.i18n("loading"))),this.renderHiddenSlot()]}renderAllListboxOptionsFiltered(){if(this.allListboxOptionsFiltered)return[a("div",{class:"gux-message-container"},a("div",{class:"gux-no-matches"},this.emptyMessage||this.i18n("noMatches"))),this.renderHiddenSlot()]}renderCreateOptionSlot(){return a("slot",{name:"create"})}render(){return this.loading?this.renderLoading():a(O,{role:"listbox","aria-multiselectable":"true",tabindex:0,class:{"has-select-all":!!this.selectAllElement}},a("slot",{onSlotchange:()=>this.updateOnSlotChange()}),this.renderAllListboxOptionsFiltered(),this.renderCreateOptionSlot())}get root(){return S(this)}static get watchers(){return{textInput:["updateOptionMultiCreateValue"]}}};P([H({childList:!0,subtree:!0})],x.prototype,"onMutation",null);x.style=j;export{x as gux_listbox_multi};
