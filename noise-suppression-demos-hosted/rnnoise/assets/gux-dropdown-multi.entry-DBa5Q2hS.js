import{r as b,c as a,f as g,h as i,g as m}from"./index-RhTaIPoL.js";import{O as v}from"./on-click-outside-C-8pG9cs-6YGsTWW7.js";import{b as E}from"./index-Bbwiw1Rf-CzeU2kBB.js";import{s as f}from"./simulate-native-event-BMRf5pjV-BcLDngo1.js";import{b as C}from"./after-next-render-Bg4q97BS-C_KTwidI.js";import{o as I}from"./on-input-disabled-state-change-Cb3FOYGS-_B452ZSd.js";import{t as y}from"./usage-BYFiy2rf-lhiVWKSr.js";import{c,s as u,g as w,a as h}from"./gux-listbox.service-C9MGEoP7-DMtsKwE7.js";import{O as T}from"./on-mutation-D5H4nH4U-CeToMEmQ.js";import"vite-plugin-node-polyfills/shims/process";import"vite-plugin-node-polyfills/shims/buffer";import"./get-closest-element-Cd4R0amv-C_5KDHD-.js";import"./get-text-content-from-nodes-DjLdmWVU-BQ4yQ5rq.js";const O="Type to filter dropdown results",F="Select...",S="Dropdown",L="{numberSelected} selected",P="Press Enter to create new option, {textInputValue}";var k={textInputResults:O,noSelection:F,dropdown:S,numberSelected:L,pressEnterToCreate:P};const D=":host{box-sizing:border-box;color:var(--gse-ui-formControl-input-populatedColor)}.gux-dropdown-container{position:relative}.gux-error.gux-target-container-not-filterable .gux-field-button,.gux-error.gux-target-container-filterable{border:var(--gse-ui-formControl-input-error-border-width) var(--gse-ui-formControl-input-error-border-style) var(--gse-ui-formControl-input-error-border-color)}.gux-disabled.gux-target-container-not-filterable .gux-field-button,.gux-disabled.gux-target-container-filterable{user-select:none;border:var(--gse-ui-formControl-input-disabled-border-width) var(--gse-ui-formControl-input-disabled-border-style) var(--gse-ui-formControl-input-disabled-border-color)}.gux-field,.gux-target-container-filterable{all:unset;box-sizing:border-box;display:flex;flex-direction:row;flex-wrap:nowrap;gap:var(--gse-ui-dropdown-gap);place-content:stretch center;align-items:center;inline-size:100%;block-size:var(--gse-ui-formControl-input-textfield-height);font-family:var(--gse-ui-formControl-input-contentText-fontFamily);font-size:var(--gse-ui-formControl-input-contentText-fontSize);font-weight:var(--gse-ui-formControl-input-contentText-fontWeight);line-height:var(--gse-ui-formControl-input-contentText-lineHeight);cursor:pointer;background-color:var(--gse-ui-formControl-input-backgroundColor)}.gux-target-container-filterable,.gux-target-container-not-filterable .gux-field{padding:var(--gse-ui-formControl-input-padding)}.gux-target-container-not-filterable .gux-field-button:hover,.gux-target-container-filterable:hover{border:var(--gse-ui-formControl-input-hover-border-width) var(--gse-ui-formControl-input-hover-border-style) var(--gse-ui-formControl-input-hover-border-color)}.gux-field.gux-input-field{block-size:var(--gse-ui-formControl-input-contentText-lineHeight)}.gux-field .gux-field-content{position:relative;display:flex;flex:1 1 0;flex-direction:row;flex-wrap:nowrap;place-content:stretch flex-start;align-items:flex-start;min-inline-size:0;block-size:var(--gse-ui-formControl-input-contentText-lineHeight)}.gux-field .gux-field-content .gux-filter,.gux-field .gux-field-content .gux-selected-option,.gux-field .gux-field-content .gux-placeholder{flex:1 1 auto;align-self:auto;order:0;overflow:hidden;text-overflow:ellipsis}.gux-field .gux-field-content .gux-filter{position:relative;block-size:100%;padding-inline-start:0}.gux-field .gux-field-content .gux-filter .gux-filter-input{all:unset;inline-size:100%;caret-color:var(--gse-ui-formControl-input-populatedColor)}.gux-field .gux-field-content .gux-filter .gux-filter-input:placeholder-shown{text-overflow:ellipsis}.gux-field .gux-field-content .gux-filter .gux-filter-input::placeholder{color:var(--gse-ui-formControl-input-placeholderColor);opacity:1}.gux-field .gux-field-content .gux-filter .gux-filter-display{white-space:pre}.gux-field .gux-field-content .gux-filter .gux-filter-display .gux-filter-text{color:var(--gse-ui-formControl-input-populatedColor)}.gux-field .gux-field-content .gux-filter .gux-filter-display .gux-filter-suggestion{color:var(--gse-ui-formControl-input-suggestionColor)}.gux-field .gux-field-content .gux-filter .gux-filter-input,.gux-field .gux-field-content .gux-filter .gux-filter-display{position:absolute}.gux-field .gux-field-content .gux-placeholder{color:var(--gse-ui-formControl-input-placeholderColor)}.gux-field .gux-expand-icon{flex:0 0 auto;align-self:auto;order:0;padding-inline-start:var(--gse-ui-dropdown-gap);color:var(--gse-ui-formControl-input-inputIcon-iconEndColor)}.gux-target-container-filterable{border:var(--gse-ui-formControl-input-default-border-width) var(--gse-ui-formControl-input-default-border-style) var(--gse-ui-formControl-input-default-border-color);border-radius:var(--gse-ui-formControl-input-borderRadius)}.gux-target-container-filterable:focus-visible{outline:var(--gse-semantic-focusOutline-md-borderWidth) solid var(--gse-semantic-border-focus);outline-offset:var(--gse-semantic-focusOutline-offset)}.gux-target-container-filterable:focus-within:has(:focus-visible){outline:var(--gse-semantic-focusOutline-md-borderWidth) solid var(--gse-semantic-border-focus);outline-offset:var(--gse-semantic-focusOutline-offset)}.gux-target-container-filterable.gux-target-container-filterable-active{border:var(--gse-ui-formControl-input-active-border-width) var(--gse-ui-formControl-input-active-border-style) var(--gse-ui-formControl-input-active-border-color);border-radius:var(--gse-ui-formControl-input-borderRadius)}.gux-target-container-filterable .gux-filter-input{background-color:inherit;border:none}.gux-target-container-filterable .gux-filter-input:focus{outline:none;border:none}.gux-target-container-filterable .gux-field-button{inline-size:auto;block-size:var(--gse-ui-formControl-input-contentText-lineHeight);margin:0;outline:none;background:inherit;border:none;box-shadow:none}.gux-target-container-filterable .gux-field-button:focus{outline:none}.gux-target-container-not-filterable .gux-field-button{border:var(--gse-ui-formControl-input-default-border-width) var(--gse-ui-formControl-input-default-border-style) var(--gse-ui-formControl-input-default-border-color);border-radius:var(--gse-ui-formControl-input-borderRadius)}.gux-target-container-not-filterable .gux-field-button:focus-visible{outline:var(--gse-semantic-focusOutline-md-borderWidth) solid var(--gse-semantic-border-focus);outline-offset:var(--gse-semantic-focusOutline-offset)}.gux-target-container-not-filterable .gux-field-button:focus-within:has(:focus-visible){outline:var(--gse-semantic-focusOutline-md-borderWidth) solid var(--gse-semantic-border-focus);outline-offset:var(--gse-semantic-focusOutline-offset)}.gux-target-container-not-filterable .gux-field-content .gux-placeholder{white-space:pre}.gux-listbox-container{box-sizing:border-box;margin:0}";var x=function(t,e,o,n){var l=arguments.length,r=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,o):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(t,e,o,n);else for(var d=t.length-1;d>=0;d--)(s=t[d])&&(r=(l<3?s(r):l>3?s(e,o,r):s(e,o))||r);return l>3&&r&&Object.defineProperty(e,o,r),r};const p=class{constructor(t){b(this,t),this.guxcreateoption=a(this,"guxcreateoption",7),this.guxexpanded=a(this,"guxexpanded",7),this.guxcollapsed=a(this,"guxcollapsed",7),this.guxfilter=a(this,"guxfilter",7),this.disabled=!1,this.required=!1,this.loading=!1,this.filterType="none",this.hasError=!1,this.exceedTargetWidth=!1,this.hasCreate=!1,this.expanded=!1,this.textInput=""}onMutation(){var t;this.listboxElement||(this.listboxElement=(t=this.root)===null||t===void 0?void 0:t.querySelector("gux-listbox-multi"),this.applyListboxEventListeners())}onInternalExpanded(t){t.stopPropagation(),this.guxexpanded.emit()}onInternalCollapsed(t){t.stopPropagation(),this.guxcollapsed.emit()}focusSelectedItemAfterRender(t){t&&this.listboxElement&&C(()=>{this.hasTextInput()?this.textInputElement.focus():this.listboxElement.focus()}),!t&&this.textInputElement&&(this.textInput="",this.textInputElement.value="")}watchDisabled(t){t&&(this.expanded=!1)}watchValue(t){this.validateValue(t,this.listboxElement)}handleFilter(t){this.guxfilter.emit(t)}getSelectedValues(){return Promise.resolve(c(this.value))}onKeydown(t){switch(t.key){case"Escape":if(this.hasTextInput()&&document.activeElement===this.listboxElement)return this.textInputElement.focus();this.collapseListbox("focusFieldButton");return;case"Tab":if(this.shiftTabFromFilterListbox(t))return t.preventDefault(),this.textInputElement.focus();if(this.shiftTabFromExpandedFilterInput(t))return t.preventDefault(),this.collapseListbox("noFocusChange");this.collapseListbox("noFocusChange");return;case"ArrowDown":this.activeElementNotListbox()&&(t.preventDefault(),this.expanded=!0,u(this.listboxElement));return;case"Enter":this.canCreateNewOption()&&this.isActiveElement()&&this.emitCreateOption(),!this.expanded&&!this.isFilterable()&&u(this.listboxElement);return;case" ":!this.expanded&&!this.isFilterable()&&u(this.listboxElement);return}}onInternallistboxoptionsupdated(t){t.stopPropagation(),requestAnimationFrame(()=>{requestAnimationFrame(()=>g(this.root))})}onClearselected(t){t.stopPropagation(),this.updateValue(void 0),this.listboxElement&&(this.listboxElement.value=void 0),this.validateValue(this.value,this.listboxElement),this.fieldButtonElement.focus()}onCreatenewoption(t){t.stopPropagation(),this.emitCreateOption()}onBlur(t){this.stopPropagationOfInternalFocusEvents(t)}onFocus(t){this.stopPropagationOfInternalFocusEvents(t)}onFocusout(t){this.stopPropagationOfInternalFocusEvents(t)}onFocusin(t){this.stopPropagationOfInternalFocusEvents(t)}onClickOutside(){this.collapseListbox("noFocusChange")}connectedCallback(){var t;this.listboxElement=(t=this.root)===null||t===void 0?void 0:t.querySelector("gux-listbox-multi"),this.listboxElement&&(this.validateValue(this.value,this.listboxElement),this.hasCreate=!!this.root.querySelector("gux-create-option"))}async componentWillLoad(){y(this.root),this.i18n=await E(this.root,k),I(this.root,()=>{g(this.root)})}componentDidLoad(){this.applyListboxEventListeners()}componentWillRender(){this.listboxElement&&(this.validateValue(this.value,this.listboxElement),this.listboxElement.loading=this.loading,this.listboxElement.filterType=this.filterType,this.listboxElement.textInput=this.textInput)}validateValue(t,e){if(t===void 0){e&&(e.value=t);return}if(this.getOptionElementByValue(t)){e.value=t;return}this.value=void 0}hasTextInput(){return this.isFilterable()||this.hasCreate}applyListboxEventListeners(){var t,e;(t=this.listboxElement)===null||t===void 0||t.addEventListener("input",o=>{o.stopPropagation(),this.updateValue(o.target.value)}),(e=this.listboxElement)===null||e===void 0||e.addEventListener("change",o=>{o.stopPropagation()})}isFilterable(){return this.filterType==="custom"||this.filterType==="starts-with"}stopPropagationOfInternalFocusEvents(t){if(this.root.contains(t.relatedTarget))return t.stopImmediatePropagation()}getOptionElementByValue(t){const e=Array.from(this.root.querySelectorAll("gux-option-multi")),o=c(t);return e.filter(n=>o.includes(n.value))}fieldButtonClick(t){var e;!((e=t.target)===null||e===void 0)&&e.closest("gux-dropdown-multi-tag")||(this.expanded=!this.expanded)}fieldButtonInputClick(){this.expanded||(this.expanded=!this.expanded)}textInputFocus(){this.expanded=!0}filterInput(t){t.stopPropagation(),this.textInput=this.textInputElement.value}shiftTabFromExpandedFilterInput(t){return t.shiftKey&&this.hasTextInput()&&this.expanded&&document.activeElement!==this.listboxElement}shiftTabFromFilterListbox(t){return t.shiftKey&&this.hasTextInput()&&document.activeElement===this.listboxElement}emitCreateOption(){this.guxcreateoption.emit(this.textInput),this.textInput="",this.textInputElement.value=""}canCreateNewOption(){return this.hasCreate&&this.textInput&&!this.listboxElement.hasExactMatch}isActiveElement(){return document.activeElement===this.root}activeElementNotListbox(){return document.activeElement!==this.listboxElement}filterKeydown(t){switch(t.key){case"ArrowDown":t.stopImmediatePropagation(),t.preventDefault(),this.listboxElement.focus(),u(this.listboxElement);return}}filterKeyup(t){switch(t.key){case" ":t.preventDefault();return}}collapseListbox(t){this.expanded&&(this.expanded=!1),t==="focusFieldButton"&&this.fieldButtonElement.focus()}updateValue(t){this.value!==t&&(this.value=t,f(this.root,"input"),f(this.root,"change"))}getTypeaheadText(t){const e=t.length;if(e>0&&!this.loading){const o=w(this.listboxElement,t);if(o&&this.filterType!=="custom"){const n=h(o);return n==null?void 0:n.substring(e)}return""}}renderTargetDisplay(){return i("span",{class:"gux-placeholder"},this.getSrSelectedText(),this.getSelectedOptionText()||this.placeholder||this.i18n("noSelection"))}getSelectedOptionText(){const t=this.getSelectedOptionValueString();return t?[t,i("gux-screen-reader-beta",null,this.placeholder)]:!1}getSelectedOptionValueString(){return this.getOptionElementByValue(this.value).map(t=>h(t)).join(", ")}getSrSelectedText(){const t=this.getOptionElementByValue(this.value);if(t.length)return i("gux-screen-reader-beta",null,this.i18n("numberSelected",{numberSelected:t.length.toString()}))}getInputAriaLabel(){return this.canCreateNewOption()&&this.isActiveElement()?this.i18n("pressEnterToCreate",{textInputValue:this.textInput}):this.i18n("textInputResults")}selectAllPresent(){var t;return this.expanded&&!!(!((t=this.listboxElement)===null||t===void 0)&&t.querySelector("gux-select-all"))}renderTag(){const t=c(this.value);if(t.length&&!this.selectAllPresent())return i("gux-dropdown-multi-tag",{disabled:this.disabled,"number-selected":t.length})}renderFilterInputField(){if(this.hasTextInput())return i("div",{class:"gux-field gux-input-field"},i("div",{class:"gux-field-content"},i("div",{class:"gux-filter"},i("div",{class:"gux-filter-display"},i("span",{class:"gux-filter-text"},this.textInput),i("span",{class:"gux-filter-suggestion"},this.getTypeaheadText(this.textInput))),i("div",{class:"input-and-dropdown-button"},i("input",{onClick:this.fieldButtonInputClick.bind(this),onFocus:this.textInputFocus.bind(this),placeholder:this.getSelectedOptionValueString()||this.placeholder||this.i18n("noSelection"),class:"gux-filter-input",type:"text","aria-label":this.getInputAriaLabel(),ref:t=>this.textInputElement=t,onInput:this.filterInput.bind(this),onKeyDown:this.filterKeydown.bind(this),onKeyUp:this.filterKeyup.bind(this),disabled:this.disabled})))))}renderPopup(){return i("div",{slot:"popup",class:"gux-listbox-container"},i("slot",null))}renderTarget(){return i("div",{class:{"gux-target-container":!0,"gux-target-container-filterable":this.hasTextInput(),"gux-target-container-filterable-active":this.expanded&&this.hasTextInput(),"gux-target-container-not-filterable":!this.hasTextInput(),"gux-error":this.hasError,"gux-disabled":this.disabled},slot:"target"},this.renderFilterInputField(),i("button",{type:"button",class:"gux-field gux-field-button",disabled:this.disabled,onClick:t=>this.fieldButtonClick(t),onMouseDown:t=>t.preventDefault(),ref:t=>this.fieldButtonElement=t,"aria-haspopup":"listbox","aria-expanded":this.expanded.toString()},this.renderTargetContent(),this.renderTag(),this.renderRadialLoading(),i("gux-icon",{class:{"gux-expand-icon":!0},size:"small","screenreader-text":this.i18n("dropdown"),iconName:this.expanded?"custom/chevron-up-small-regular":"custom/chevron-down-small-regular"})))}renderTargetContent(){if(!this.hasTextInput())return i("span",{class:"gux-field-content"},this.renderTargetDisplay())}renderRadialLoading(){if(this.loading&&!this.expanded)return i("gux-radial-loading",{context:"input"})}render(){return[i("div",{key:"cf3ebcb73b8280fd28db6bc7e560404d48ce9755",class:"gux-dropdown-container"},i("gux-popup",{key:"88e5ceb919184267f85b4e484c1829e37b60492f",expanded:this.expanded&&(!this.loading||this.isFilterable()),disabled:this.disabled||this.loading&&!this.isFilterable(),exceedTargetWidth:this.exceedTargetWidth},this.renderTarget(),this.renderPopup()))]}static get delegatesFocus(){return!0}get root(){return m(this)}static get watchers(){return{expanded:["focusSelectedItemAfterRender"],disabled:["watchDisabled"],value:["watchValue"],textInput:["handleFilter"]}}};x([T({childList:!0,subtree:!0})],p.prototype,"onMutation",null);x([v({triggerEvents:"mousedown"})],p.prototype,"onClickOutside",null);p.style=D;export{p as gux_dropdown_multi};
