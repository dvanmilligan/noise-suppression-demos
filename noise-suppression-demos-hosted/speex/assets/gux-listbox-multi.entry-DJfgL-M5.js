import{r as p,c,h as i,H as m,g}from"./index-CV4KLuUB.js";import{c as n,h as x,s as r,a as l,b as u,d as f,e as b,f as v,i as O,j as a,k as C,o as w}from"./gux-listbox.service-28ef1770-C3DRrCFi.js";import{b as y}from"./index-3f1e5ba8-CrdMLsjJ.js";import{w as S}from"./when-event-is-from-2aac15f0-B4cyA2sH.js";import{s as h}from"./simulate-native-event-e0631897-BcLDngo1.js";import{t as E}from"./usage-6129fffe-6kP8_2TX.js";import{b as d}from"./after-next-render-07a41f53-C_KTwidI.js";import"vite-plugin-node-polyfills/shims/process";import"vite-plugin-node-polyfills/shims/buffer";import"./get-closest-element-728b9f18-C_5KDHD-.js";const L="Add {name}",M="No matches",A="Loading...",I={add:L,noMatches:M,loading:A},k=":host{box-sizing:border-box;display:block;max-height:var(--gse-ui-menu-maxHeight);padding:var(--gse-ui-menu-padding);overflow-y:auto;background:var(--gse-ui-menu-backgroundColor);border:var(--gse-ui-menu-border-width) var(--gse-ui-menu-border-style) var(--gse-ui-menu-border-color);border-radius:var(--gse-ui-menu-borderRadius);outline:none;box-shadow:var(--gse-ui-menu-boxShadow-x) var(--gse-ui-menu-boxShadow-y) var(--gse-ui-menu-boxShadow-blur) var(--gse-ui-menu-boxShadow-spread) var(--gse-ui-menu-boxShadow-color);scrollbar-color:var(--gse-ui-menu-scrollbar-foregroundColor)}.gux-message-container{display:flex;flex-direction:column;flex-wrap:nowrap;place-content:stretch center;align-items:center}.gux-message-container .gux-no-matches{box-sizing:border-box;height:var(--gse-ui-menu-option-height);font-family:var(--gse-ui-dropdown-menu-emptyState-subheader-text-fontFamily);font-size:var(--gse-ui-dropdown-menu-emptyState-subheader-text-fontSize);font-weight:var(--gse-ui-dropdown-menu-emptyState-subheader-text-fontWeight);line-height:var(--gse-ui-dropdown-menu-emptyState-subheader-text-lineHeight);color:var(--gse-ui-dropdown-menu-emptyState-subheader-foregroundColor)}",V=k,H=class{constructor(t){p(this,t),this.internallistboxoptionsupdated=c(this,"internallistboxoptionsupdated",7),this.value=void 0,this.loading=!1,this.filter="",this.textInput="",this.filterType="none",this.emptyMessage=void 0,this.listboxOptions=[],this.allListboxOptionsFiltered=void 0,this.hasExactMatch=!1}onBlur(){n(this.root)}selectNewCustomOption(t){this.updateValue(t.detail)}onKeydown(t){var e;if(!x(this.root)){t.preventDefault(),r(this.root);return}switch(t.key){case"Enter":t.preventDefault(),!((e=this.optionCreateElement)===null||e===void 0)&&e.active?(this.optionCreateElement.guxEmitInternalCreateNewOption(),d(()=>{r(this.root)})):a(this.root,o=>this.updateValue(o));return;case"ArrowDown":t.preventDefault(),v(this.root)?(t.stopPropagation(),O(this.root)):u(this.root);return;case"ArrowUp":{t.preventDefault(),f(this.root)?(t.stopPropagation(),b(this.root)):l(this.root);return}case"Home":{t.preventDefault(),u(this.root);return}case"End":{t.preventDefault(),l(this.root);return}case" ":{t.preventDefault();return}}if(t.key.length===1){C(this.root,t.key);return}}onKeyup(t){var e;switch(t.key){case" ":!((e=this.optionCreateElement)===null||e===void 0)&&e.active?(this.optionCreateElement.guxEmitInternalCreateNewOption(),d(()=>{r(this.root)})):a(this.root,o=>this.updateValue(o));return}}onMousemove(){n(this.root)}onClick(t){S("gux-option-multi",t,e=>{w(e,o=>this.updateValue(o))})}async guxSelectActive(){a(this.root,t=>this.updateValue(t))}getHasExactMatch(){let t=!1;return this.hasExactMatch=!1,this.listboxOptions.forEach(e=>{var o,s;((s=(o=e.textContent)===null||o===void 0?void 0:o.toLowerCase())===null||s===void 0?void 0:s.trim())==this.textInput.toLowerCase().trim()&&(t=!0,this.hasExactMatch=!0)}),t}updateOptionMultiCreateValue(){this.optionCreateElement&&(this.optionCreateElement.value=this.textInput,this.optionCreateElement.filtered=!this.textInput||this.getHasExactMatch())}getSelectedValues(){return this.value?this.value.split(","):[]}updateOnSlotChange(){this.setListboxOptions(),this.updateListboxOptions()}getOptionCreateElement(){this.optionCreateElement=this.root.querySelector("gux-create-option")}setListboxOptions(){this.listboxOptions=Array.from(this.root.children).filter(t=>t.tagName==="GUX-OPTION-MULTI"),this.internallistboxoptionsupdated.emit()}updateListboxOptions(){this.listboxOptions.forEach(t=>{t.selected=this.getSelectedValues().includes(t.value),this.filterType!=="custom"&&(t.filtered=!t.textContent.trim().toLowerCase().startsWith(this.textInput.toLowerCase()))})}updateValue(t){if(this.getSelectedValues().includes(t))this.value=this.getSelectedValues().filter(e=>e!==t).join(",");else{const e=[...this.getSelectedValues(),t];this.value=e.join(",")}h(this.root,"input"),h(this.root,"change")}async componentWillLoad(){E(this.root),this.i18n=await y(this.root,I),this.setListboxOptions(),this.getOptionCreateElement()}componentWillRender(){this.setListboxOptions(),this.updateListboxOptions(),this.allListboxOptionsFiltered=this.listboxOptions.filter(t=>!t.filtered).length===0}renderHiddenSlot(){return i("div",{hidden:!0},i("slot",{onSlotchange:()=>this.setListboxOptions()}))}renderLoading(){return[i("div",{class:"gux-message-container"},i("gux-radial-loading",{context:"modal"}),i("span",null,this.i18n("loading"))),this.renderHiddenSlot()]}renderAllListboxOptionsFiltered(){if(this.allListboxOptionsFiltered)return[i("div",{class:"gux-message-container"},i("div",{class:"gux-no-matches"},this.emptyMessage||this.i18n("noMatches"))),this.renderHiddenSlot()]}renderCreateOptionSlot(){return i("slot",{name:"create"})}render(){return this.loading?this.renderLoading():i(m,{role:"listbox","aria-multiselectable":"true",tabindex:0},i("slot",{onSlotchange:()=>this.updateOnSlotChange()}),this.renderAllListboxOptionsFiltered(),this.renderCreateOptionSlot())}get root(){return g(this)}static get watchers(){return{textInput:["updateOptionMultiCreateValue"]}}};H.style=V;export{H as gux_listbox_multi};
